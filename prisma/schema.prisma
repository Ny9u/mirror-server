generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  @@map("User")
  id          Int          @default(autoincrement()) @id
  username    String
  email       String       @unique
  password    String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  modelConfig ModelConfig?
}

model ModelConfig {
  @@map("ModelConfig")
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  baseURL   String
  apiKey    String
  modelName String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Avatar {
  // 可以显示指定表名 因为默认prisma会将模型名转为小写去进行查询
  @@map("Avatar")
  id    Int  @id
  avatarUrl String 
}

model UserFavorite {
  @@map("UserFavorite")
  id         Int      @default(autoincrement()) @id
  userId     Int
  contentId  String   // 收藏内容ID，与FavoriteContent表的id对应
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // 确保用户对同一内容只能收藏一次
  @@unique([userId, contentId])
  @@index([userId])
  @@index([contentId])
}

model FavoriteContent {
  @@map("FavoriteContent")
  id           String   @id // 使用字符串ID，可以是UUID或其他唯一标识
  title        String
  description  String?
  conversation Json     // 存储对话数组，使用JSON类型
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model UserConversation {
  @@map("UserConversation")
  id        String   @id
  userId    Int
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model ConversationDetail {
  @@map("ConversationDetail") 
  id             Int      @id @default(autoincrement())
  conversationId String
  content        Json
  createdAt      DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([conversationId])
}

model Knowledge {
  @@map("Knowledge")
  id        Int      @id @default(autoincrement())
  userId    Int
  fileName  String
  content   String   @db.Text
  preview   String?  @db.Text
  size      Int?
  type      String?
  fileData  Bytes?   // 存储源文件二进制数据
  embedding Unsupported("vector(1536)")?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}
